(function(l,x,b){"use strict";const p=/https:\/\/cdn.discordapp.com\/emojis\/(\d+).(webp|gif|png)/,f=s=>s.replace(/^[ \t]+/,"").replace(/[ \t]+$/,""),j=b.before("updateRows",x.ReactNative.NativeModules.DCDChatManager,([s,N,v])=>{const g=JSON.parse(N);for(const o of g)if(o.message&&o.changeType!==3){const{content:e,embeds:a}=o.message;if(!Array.isArray(e))continue;const d=e.findIndex(t=>t.type==="link"&&p.test(t.target));if(d===-1)continue;const m=[...e],u=e.splice(d).filter(t=>t.type!=="text"||t.content!==`
`),h=u.map(t=>p.exec(t.target)).filter(Boolean).map(([,t,n])=>[t,`https://cdn.discordapp.com/emojis/${t}.webp?size=160`,n==="gif"]),O=u.map(t=>t.target);if(!e.length){o.message.content=m;continue}for(let t=0;t<e.length;t++){const n=e[t];if(n.type!=="text")continue;let c=n.content.indexOf("  ");if(c===-1&&(c=n.content.lastIndexOf(`
`)),c===-1)continue;const y=h.shift();if(!y)break;const[k,r,S]=y,z=n.content.slice(0,c),A=n.content.slice(c);n.content=(t!==0?" ":"")+f(z)+" ",e.splice(t+1,0,{type:"customEmoji",id:k,alt:"<realmoji>",src:r,frozenSrc:S?r.replace("webp","gif"):r},{type:"text",content:" "+f(A)})}if(h.length){o.message.content=m;continue}const i=e[e.length-1];i?.type==="text"&&(i.content===`
`?e.length=e.length-1:i.content=i.content.trimEnd());for(let t=0;t<a.length;t++){const n=a[t];n.type==="image"&&O.includes(n.url)&&a.splice(t--,1)}}return[s,JSON.stringify(g),v]}),w=()=>j();return l.onUnload=w,l})({},vendetta.metro.common,vendetta.patcher);
