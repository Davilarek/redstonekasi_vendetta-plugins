(function(p,h,y){"use strict";const l=/https:\/\/cdn.discordapp.com\/emojis\/(\d+).(webp|gif|png)\?size=\d+/,f=i=>i.replace(/^[ \t]+/,"").replace(/[ \t]+$/,""),x=y.before("updateRows",h.ReactNative.NativeModules.DCDChatManager,([i,j,w])=>{const d=JSON.parse(j);for(const s of d)if(s.message&&s.changeType!==3){const{content:n,embeds:a}=s.message;if(!Array.isArray(n))continue;const g=n.findIndex(t=>t.type==="link"&&l.test(t.target));if(g===-1)continue;const m=n.splice(g).filter(t=>t.type!=="text"||t.content!==`
`),N=m.map(t=>l.exec(t.target)).filter(Boolean).map(([,t,e])=>[t,`https://cdn.discordapp.com/emojis/${t}.webp?size=160`,e==="gif"]),O=m.map(t=>t.target);for(let t=0;t<n.length;t++){const e=n[t];if(e.type!=="text")continue;const u=N.shift();if(!u)break;let o=e.content.indexOf("  ");if(o===-1&&(o=e.content.lastIndexOf(`
`)),o===-1)continue;const[v,r,z]=u,S=e.content.slice(0,o),k=e.content.slice(o);e.content=(t!==0?" ":"")+f(S)+" ",n.splice(t+1,0,{type:"customEmoji",id:v,alt:"<realmoji>",src:r,frozenSrc:z?r.replace("webp","gif"):r},{type:"text",content:" "+f(k)})}const c=n[n.length-1];c.type==="text"&&(c.content===`
`?n.length=n.length-1:c.content=c.content.trimEnd());for(let t=0;t<a.length;t++){const e=a[t];e.type==="image"&&O.includes(e.url)&&a.splice(t--,1)}}return[i,JSON.stringify(d),w]}),b=()=>x();return p.onUnload=b,p})({},vendetta.metro.common,vendetta.patcher);
