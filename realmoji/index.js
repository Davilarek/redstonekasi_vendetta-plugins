(function(r,h,y){"use strict";const l=/https:\/\/cdn.discordapp.com\/emojis\/(\d+).webp\?size=\d+/,p=s=>s.replace(/^[ \t]+/,"").replace(/[ \t]+$/,""),x=y.before("updateRows",h.ReactNative.NativeModules.DCDChatManager,([s,j,N])=>{const d=JSON.parse(j);for(const i of d)if(i.message&&i.changeType!==3){const{content:e,embeds:a}=i.message;if(!Array.isArray(e))continue;const f=e.findIndex(t=>t.type==="link"&&l.test(t.target));if(f===-1)continue;const m=e.splice(f).filter(t=>t.type!=="text"||t.content!==`
`),v=m.map(t=>l.exec(t.target)).filter(Boolean).map(([,t])=>[t,`https://cdn.discordapp.com/emojis/${t}.webp?size=160`]),O=m.map(t=>t.target);for(let t=0;t<e.length;t++){const n=e[t];if(n.type!=="text")continue;const g=v.shift();if(!g)break;let o=n.content.indexOf("  ");if(o===-1&&(o=n.content.lastIndexOf(`
`)),o===-1)continue;const[w,u]=g,z=n.content.slice(0,o),M=n.content.slice(o);n.content=(t!==0?" ":"")+p(z)+" ",e.splice(t+1,0,{type:"customEmoji",id:w,alt:"<realmoji>",src:u,frozenSrc:u},{type:"text",content:" "+p(M)})}const c=e[e.length-1];c.type==="text"&&(c.content===`
`?e.length=e.length-1:c.content=c.content.trimEnd());for(let t=0;t<a.length;t++){const n=a[t];n.type==="image"&&O.includes(n.url)&&a.splice(t--,1)}}return[s,JSON.stringify(d),N]}),b=()=>x();return r.onUnload=b,r})({},vendetta.metro.common,vendetta.patcher);
